
<script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
<script>
var account = null;
var abi = [
    {
        "inputs": [],
        "stateMutability": "payable",
        "type": "constructor"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "address",
                "name": "_from",
                "type": "address"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "_streamId",
                "type": "uint256"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "_amount",
                "type": "uint256"
            },
            {
                "indexed": false,
                "internalType": "string",
                "name": "_message",
                "type": "string"
            }
        ],
        "name": "MessageAdded",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "index",
                "type": "uint256"
            }
        ],
        "name": "StreamCreated",
        "type": "event"
    },
    {
        "inputs": [],
        "name": "Time_call",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "addStream",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "payable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "stream_id",
                "type": "uint256"
            }
        ],
        "name": "endStream",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "stream_id",
                "type": "uint256"
            },
            {
                "internalType": "uint256",
                "name": "message_id",
                "type": "uint256"
            }
        ],
        "name": "getMessage",
        "outputs": [
            {
                "internalType": "string",
                "name": "",
                "type": "string"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "stream_id",
                "type": "uint256"
            }
        ],
        "name": "getStream",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "stream_id",
                "type": "uint256"
            },
            {
                "internalType": "string",
                "name": "messageStr",
                "type": "string"
            },
            {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "sendMessage",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "name": "streams",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "id",
                "type": "uint256"
            },
            {
                "internalType": "uint256",
                "name": "messageSize",
                "type": "uint256"
            },
            {
                "internalType": "address payable",
                "name": "owner",
                "type": "address"
            },
            {
                "internalType": "bool",
                "name": "hasEnded",
                "type": "bool"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    }
]

var bytecode = `0x6080604052610f3c806100136000396000f3fe6080604052600436106100705760003560e01c806364d60d911161004e57806364d60d91146100e7578063894e9a0d14610127578063c6798c0314610164578063da0632ad1461018057610070565b806303261030146100755780632ec7f02c146100a057806350d55afc146100be575b600080fd5b34801561008157600080fd5b5061008a6101bd565b6040516100979190610adb565b60405180910390f35b6100a86101c5565b6040516100b59190610adb565b60405180910390f35b3480156100ca57600080fd5b506100e560048036038101906100e091906108f1565b6102ad565b005b3480156100f357600080fd5b5061010e600480360381019061010991906108f1565b6103a1565b60405161011e9493929190610af6565b60405180910390f35b34801561013357600080fd5b5061014e600480360381019061014991906108f1565b61040e565b60405161015b9190610adb565b60405180910390f35b61017e6004803603810190610179919061091e565b61043c565b005b34801561018c57600080fd5b506101a760048036038101906101a2919061098d565b6106fd565b6040516101b49190610a79565b60405180910390f35b600042905090565b6000806000600181600181540180825580915050039060005260206000209060040201905060016000805490506101fc9190610c9b565b8160000181905550338160030160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000816002018190555060008160030160146101000a81548160ff0219169083151502179055507f3056c83b2054f047a75323e4d65d14a30d96f2cecc797f0b03f3eeb786db876181600001546040516102a19190610adb565b60405180910390a15090565b3373ffffffffffffffffffffffffffffffffffffffff16600082815481106102d8576102d7610e1a565b5b906000526020600020906004020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610360576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161035790610abb565b60405180910390fd5b60016000828154811061037657610375610e1a565b5b906000526020600020906004020160030160146101000a81548160ff02191690831515021790555050565b600081815481106103b157600080fd5b90600052602060002090600402016000915090508060000154908060020154908060030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060030160149054906101000a900460ff16905084565b600080828154811061042357610422610e1a565b5b9060005260206000209060040201600001549050919050565b600015156000848154811061045457610453610e1a565b5b906000526020600020906004020160030160149054906101000a900460ff161515146104b5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104ac90610a9b565b60405180910390fd5b600083815481106104c9576104c8610e1a565b5b906000526020600020906004020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc633b9aca00836105249190610c41565b9081150290604051600060405180830381858888f1935050505015801561054f573d6000803e3d6000fd5b50600080848154811061056557610564610e1a565b5b9060005260206000209060040201600201549050816000858154811061058e5761058d610e1a565b5b906000526020600020906004020160010160008381526020019081526020016000206000018190555082600085815481106105cc576105cb610e1a565b5b9060005260206000209060040201600101600083815260200190815260200160002060010190805190602001906106049291906107c9565b5061060d6101bd565b6000858154811061062157610620610e1a565b5b90600052602060002090600402016001016000838152602001908152602001600020600201819055506001600085815481106106605761065f610e1a565b5b90600052602060002090600402016002015461067c9190610beb565b600085815481106106905761068f610e1a565b5b9060005260206000209060040201600201819055503373ffffffffffffffffffffffffffffffffffffffff167fc50b72f4132a078d4d47bce918a2a9320fa66edd2c758d9e07f6c437f45aa0e18584866040516106ef93929190610b3b565b60405180910390a250505050565b60606000838154811061071357610712610e1a565b5b90600052602060002090600402016001016000838152602001908152602001600020600101805461074390610d59565b80601f016020809104026020016040519081016040528092919081815260200182805461076f90610d59565b80156107bc5780601f10610791576101008083540402835291602001916107bc565b820191906000526020600020905b81548152906001019060200180831161079f57829003601f168201915b5050505050905092915050565b8280546107d590610d59565b90600052602060002090601f0160209004810192826107f7576000855561083e565b82601f1061081057805160ff191683800117855561083e565b8280016001018555821561083e579182015b8281111561083d578251825591602001919060010190610822565b5b50905061084b919061084f565b5090565b5b80821115610868576000816000905550600101610850565b5090565b600061087f61087a84610b9e565b610b79565b90508281526020810184848401111561089b5761089a610e7d565b5b6108a6848285610d17565b509392505050565b600082601f8301126108c3576108c2610e78565b5b81356108d384826020860161086c565b91505092915050565b6000813590506108eb81610eef565b92915050565b60006020828403121561090757610906610e87565b5b6000610915848285016108dc565b91505092915050565b60008060006060848603121561093757610936610e87565b5b6000610945868287016108dc565b935050602084013567ffffffffffffffff81111561096657610965610e82565b5b610972868287016108ae565b9250506040610983868287016108dc565b9150509250925092565b600080604083850312156109a4576109a3610e87565b5b60006109b2858286016108dc565b92505060206109c3858286016108dc565b9150509250929050565b6109d681610ccf565b82525050565b6109e581610ce1565b82525050565b60006109f682610bcf565b610a008185610bda565b9350610a10818560208601610d26565b610a1981610e8c565b840191505092915050565b6000610a31601083610bda565b9150610a3c82610e9d565b602082019050919050565b6000610a54601c83610bda565b9150610a5f82610ec6565b602082019050919050565b610a7381610d0d565b82525050565b60006020820190508181036000830152610a9381846109eb565b905092915050565b60006020820190508181036000830152610ab481610a24565b9050919050565b60006020820190508181036000830152610ad481610a47565b9050919050565b6000602082019050610af06000830184610a6a565b92915050565b6000608082019050610b0b6000830187610a6a565b610b186020830186610a6a565b610b2560408301856109cd565b610b3260608301846109dc565b95945050505050565b6000606082019050610b506000830186610a6a565b610b5d6020830185610a6a565b8181036040830152610b6f81846109eb565b9050949350505050565b6000610b83610b94565b9050610b8f8282610d8b565b919050565b6000604051905090565b600067ffffffffffffffff821115610bb957610bb8610e49565b5b610bc282610e8c565b9050602081019050919050565b600081519050919050565b600082825260208201905092915050565b6000610bf682610d0d565b9150610c0183610d0d565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115610c3657610c35610dbc565b5b828201905092915050565b6000610c4c82610d0d565b9150610c5783610d0d565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615610c9057610c8f610dbc565b5b828202905092915050565b6000610ca682610d0d565b9150610cb183610d0d565b925082821015610cc457610cc3610dbc565b5b828203905092915050565b6000610cda82610ced565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b83811015610d44578082015181840152602081019050610d29565b83811115610d53576000848401525b50505050565b60006002820490506001821680610d7157607f821691505b60208210811415610d8557610d84610deb565b5b50919050565b610d9482610e8c565b810181811067ffffffffffffffff82111715610db357610db2610e49565b5b80604052505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f53747265616d2068617320656e64656400000000000000000000000000000000600082015250565b7f4f6e6c79206f776e65722063616e2073746f7020612073747265616d00000000600082015250565b610ef881610d0d565b8114610f0357600080fd5b5056fea26469706673582212200c829e3cb746c8b692a93131e410a3198db6b1778f592cd7588f6a4c45b5988f64736f6c63430008070033`

(async () => {
    if (window.ethereum) {
        await window.ethereum.request({ method: 'eth_requestAccounts' }) ;
        window.web3 = new Web3(window.ethereum);

        var accounts = await web3.eth.getAccounts();
        account = accounts[0];
        // deploy(abi, bytecode);
    }
})()

const deploy1 = async(abi, bytecode) => {
    const deployingContract = new web3.eth.Contract(abi).deploy({
        data: bytecode,
        arguments: []
    });
    const estimatedGas = await deployingContract.estimateGas();

    const deployedContract = await deployingContract.send({
        from: account,
        gas: estimatedGas
    })

    console.log(deployedContract.options.address);
}
</script>